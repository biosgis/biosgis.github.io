<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <meta name="author" content="bios@wildlife.ca.gov" />
    <meta name="description" content="CWHR Life History Accounts and Range Maps" />
    <meta name="generator" content="imaps-20161020-cwhr" />
    <meta name="keywords" content="wildlife, habitat, data, analysis, species, animals, plants, natural communities, rare, threatened, endangered, special, maps, GIS, modeling, resources, life history" />
    <meta name="subject" content="To provide high quality scientific information, tools, and expertise for making informed decisions regarding our biological resources." />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!--The viewport meta tag is used to improve the presentation and behavior of the samples
      on iOS devices-->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <title>CWHR Life History Accounts &amp; Range Maps</title>
    <link rel="stylesheet" href="//js.arcgis.com/4.7/esri/css/main.css">
    <script src="//js.arcgis.com/4.7/"></script>
    <style type="text/css">
        body {
            color: #555;
            font: normal normal normal 100% arial;
        }
        option {
            font-size: 100%;
        }
        .smoke {
            color: whitesmoke;
        }
        .hide {
            display: none;
        }
        /*--CWHR_Life_History_Accounts&Range_Maps-Link Button CSS--*/
        a.linkbutton {
            background-color: slategray;
            border: 1px solid silver;
            border-radius: 5px;
            color: white;
            margin-bottom: 10px;
            padding: 5px 10px;
            text-decoration: none;
        }
        a.linkbutton:hover {
            background-color: steelblue;
        }
        #app-build {
            position: fixed; bottom: 5px; left: 5px;
            color: lightgray;
            font-size: small;
        }
    </style>
    <script type="text/javascript" src="//www.google.com/jsapi"></script>
    <!--<script src="//js.arcgis.com/3.18/"></script>-->
    <script>
        //cwhrlife.js-20161020-DOING--CONVERT TO JSAPI 4 
        cwhr = {
            namesUrl: "//services2.arcgis.com/Uq9r85Potqm3MfRV/arcgis/rest/services/CWHR_Species/FeatureServer/1",
            docsUrl: "//services2.arcgis.com/Uq9r85Potqm3MfRV/arcgis/rest/services/CWHR_Species/FeatureServer/0"
        };
        // SpeciesNamesTable=CWHRSpecies_FINAL20161004, DocIdListTable=CWHRDocListFinal20161004
        require([
            "esri/tasks/QueryTask",
            "esri/tasks/support/Query",
          "dojo/dom",
          "dojo/on",
          "dojo/parser",
          "dojo/ready", 
          "dojo/domReady!"
        ], function (QueryTask, Query, dom, on, parser, ready) {

            console.log("DO amd required loader");
            parser.parse();

            cwhr.queryNamesPicklist = function (taxon) {
                //console.log("DO cwhr.queryNamesPicklist: " + taxon);
                var queryTask = new QueryTask({
                    url: cwhr.namesUrl
                });
                var query = new Query();
                query.returnGeometry = false;
                query.outFields = ["CommonName", "CWHR_ID", "SCI_NAME"];
                query.orderByFields = ["CommonName"];
                query.where = "TaxonCategory = '" + taxon + "'";
                var sel = document.getElementById(taxon.toLowerCase() + "s");
                var callback = function (results) {
                    //console.log("CALLBACK cwhr.queryNamesPicklist/callback: " + results.features.length);
                    var rc = results.features.length;
                    for (var i = 0; i < rc; i++) {
                        var attrs = results.features[i].attributes;
                        var opt = document.createElement("option");
                        opt.value = attrs["CWHR_ID"];
                        opt.innerHTML = attrs["CommonName"];
                        opt.title = attrs["SCI_NAME"];
                        sel.appendChild(opt);
                    }
                    console.log(rc + " species of " + taxon + "s listed");
                }
                //queryTask.execute(query, callback);//=FAIL in jsapi4.1
                queryTask.execute(query).then(callback);//function(results) {
                //    console.log(results.features.length + " called back");
                //});
            }

            cwhr.queryDocsForSpecies = function (uiid) {
                var sel = document.getElementById(uiid);
                var val = sel.options[sel.selectedIndex].value;
                var name = sel.options[sel.selectedIndex].innerHTML;
                var queryTask = new QueryTask({url: cwhr.docsUrl});
                var query = new Query();
                query.returnGeometry = false;
                query.outFields = ["DocumentID", "Subject", "Title"];
                query.where = "CWHRCode = '" + val + "'";
                var callback = function (results) {
                    var rc = results.features.length;
                    if (rc == 0) {
                        document.getElementById("errMsg").innerHTML = "No documents found for " + name;
                    } else {
                        document.getElementById("errMsg").innerHTML = "";
                    }
                    for (var i = 0; i < rc; i++) {
                        var attrs = results.features[i].attributes;
                        var tip = attrs["Title"];
                        var docId = attrs["DocumentID"];
                        if (tip.indexOf("Life history") >= 0) {
                            document.getElementById("lhlink").href =
                                "//nrm.dfg.ca.gov/FileHandler.ashx?DocumentID=" + docId + "&inline=1";
                            document.getElementById("LHbutton").title = tip;
                            document.getElementById("LHbutton").style.display = "";
                        }
                        if (tip.indexOf("Range map") >= 0) {
                            document.getElementById("rmlink").href =
                                "//nrm.dfg.ca.gov/FileHandler.ashx?DocumentID=" + docId + "&inline=1";
                            document.getElementById("RMbutton").title = tip;
                            document.getElementById("RMbutton").style.display = "";
                        }
                    }
                }
                queryTask.execute(query).then(callback);
                //--Clear other picklists--20161027
                var taxa = ["amphibians", "reptiles", "birds", "mammals"];
                for (var i = 0; i < taxa.length; i++) {
                    if (taxa[i] != uiid) {
                        document.getElementById(taxa[i]).selectedIndex = 0;
                    }
                }
            }

            ready(function () {
                console.log("amd required loader ready");
                cwhr.queryNamesPicklist("Amphibian");
                cwhr.queryNamesPicklist("Bird");
                cwhr.queryNamesPicklist("Reptile");
                cwhr.queryNamesPicklist("Mammal");
            });
            //on(window, "load", function() {
            //    console.log("On window ready query for taxon category lists");
            //    cwhr.queryNamesPicklist("Amphibian");
            //    cwhr.queryNamesPicklist("Bird");
            //    cwhr.queryNamesPicklist("Reptile");
            //    cwhr.queryNamesPicklist("Mammal");
            //});//=equivalent of readyfxn

            console.log("DONE amd required loader");
        });//DONE AMD REQUIRED
    </script>
    <script type="text/javascript">
        vn = "20161027";//versiondatemaster
        appVersion = vn.substr(3, 1) + "." + parseInt(vn.substr(4, 2)) + "." + vn.substr(6, 2);
        var defaultMainList = "Science";

        function onPageLoad() {
            console.log("Window onload called");
            document.getElementById("LHbutton").style.display = "none";
            document.getElementById("RMbutton").style.display = "none";
            var tags = document.getElementsByTagName("meta");
            for (var i = 0; i < tags.length; i++) {
                if (tags[i].name == "generator") {
                    tags[i].content = "imaps-" + vn + "-cwhrlife";
                    document.getElementById("app-build").innerHTML = "v" + vn;
                }
            }
        }
        window.onload = onPageLoad;
    </script>
</head>
<body>
    <!-- BEGIN MIDDLE COLUMN CONTENT - PRIMARY PAGE CONTENT -->
    <div id="cawildlife-main" style="width:90%;">
        <h1 class="smoke hide">CWHR Life History Accounts and Range Maps</h1>
        <form id="cawildlife-form" method="get" action="cawildlife.html">
            <div></div>
        </form>
        <div style="float:right; margin: 5%;">
            <!--margin-right:50px;margin-top:20px;-->
            <img src="//www.dfg.ca.gov/biogeodata/cwhr/images/shield.jpg" height=289 width=219 vspace=0 hspace=0 align="top" border=0 />
        </div>
        <div style="margin: 2%; width: 55%;">
            <!--float:left; margin-left:30px;margin-top:10px;margin-bottom:10px;width:340px;-->
            <h2 id="loadTitle">Select a species</h2>
            <div id="noDataError" style="text-align:right; color:Red; font-size: 0.83em; font-weight:normal">
                <span id="errMsg"></span>
            </div>
            <hr />
            <div id="itemSelection" style="text-align:center;">
                <h3>Amphibians</h3>
                <select name="amphibians" onchange="cwhr.queryDocsForSpecies(this.id)" id="amphibians" title="  Select an Amphibian from this list to view its Life History or a Map of its Range in California  " style="width:300px;">
                    <option selected="selected" value="NONE">(Select one from this list)</option>
                </select>
                <h3>Reptiles</h3>
                <select name="reptiles" onchange="cwhr.queryDocsForSpecies(this.id)" id="reptiles" title="  Select a Reptile from this list to view its Life History or a Map of its Range in California  " style="width:300px;">
                    <option selected="selected" value="NONE">(Select one from this list)</option>
                </select>
                <h3>Birds</h3>
                <select name="birds" onchange="cwhr.queryDocsForSpecies(this.id)" id="birds" title="  Select a Bird from this list to view its Life History or a Map of its Range in California  " style="width:300px;">
                    <option selected="selected" value="NONE">(Select one from this list)</option>
                </select>
                <h3>Mammals</h3>
                <select name="mammals" onchange="cwhr.queryDocsForSpecies(this.id)" id="mammals" title="  Select a Mammal from this list to view its Life History or a Map of its Range in California  " style="width:300px;">
                    <option selected="selected" value="NONE">(Select one from this list)</option>
                </select>
            </div>
            <hr />
            <div id="selectButtons" style="margin-top: 5%; text-align: center;">
                <!--<div id="LHbutton" style="display: block;">
                    <a href="//nrm.dfg.ca.gov/FileHandler.ashx?DocumentID=&inline=1" id="lhlink" target="_blank">
                        <img src="//www.dfg.ca.gov/biogeodata/cwhr/images/LifeHistoryButton.gif" alt="Get the Life History of the selected species" width="234" height="30" border="0">
                    </a>
                </div>
                <div id="RMbutton" style="display: block;">
                    <a href="//nrm.dfg.ca.gov/FileHandler.ashx?DocumentID=&inline=1" id="rmlink" target="_blank">
                        <img src="//www.dfg.ca.gov/biogeodata/cwhr/images/RangeMapButton.gif" alt="Get the RangeMap for the selected species" width="234" height="30" border="0">
                    </a>
                </div>-->
                <h4 id="LHbutton">
                    <a href="http://nrm.dfg.ca.gov/FileHandler.ashx?DocumentID=&inline=1" id="lhlink" target="_blank" class="linkbutton">
                        <img src="http://www.dfg.ca.gov/biogeodata/cwhr/images/LifeHistoryButton.gif" alt="Get the Life History of the selected species" width="234" height="30" border="0" style="display: none;">
                        Click here to view the Life History
                    </a>
                </h4>
                <h4 id="RMbutton">
                    <a href="http://nrm.dfg.ca.gov/FileHandler.ashx?DocumentID=&inline=1" id="rmlink" target="_blank" class="linkbutton">
                        <img src="http://www.dfg.ca.gov/biogeodata/cwhr/images/RangeMapButton.gif" alt="Get the RangeMap for the selected species" width="234" height="30" border="0" style="display: none;">
                        Click here to view the Range Map
                    </a>
                </h4>
            </div>
        </div>

        <div style="margin-top: 10px; padding: 10px;">
            <p>
                These life history accounts and range maps represent updated versions of the species information in the three-volume
                set &quot;California's Wildlife&quot; edited by Zeiner, D.C. et al 1988-1990. There are also accounts for 48 more
                species here than in the original publication, bringing the total up to 694.
            </p>
            <p>
                The information was prepared under contract with the best available experts for various taxonomic groups. Authors and
                reviewers names appear on the individual life history accounts. Accounts were initially edited by Marshall White and,
                in later years, by California Wildlife Habitat Relationships (CWHR) Program staff with the California Department of
                Fish and Game. Update dates are noted on individual life history accounts. Revision histories are also noted on
                individual range maps.
            </p>
            <p>
                The life history accounts and range maps are designed to support the computerized species-habitat relationships
                database models in the CWHR System. The system is continually being revised. Users are encouraged to submit corrections
                and additional information to:
            </p>
            <p style="margin-left:20px;">
                CWHR Program Coordinator<br />
                California Department of Fish and Wildlife<br />
                1700 9th Street<br />
                Sacramento, CA 95811
            </p>
            <!--<script>writeEmail('cwhr', 'wildlife.ca.gov', 'CWHR email address')</script>-->
            <a href="mailto:cwhr@wildlife.ca.gov">CWHR email address</a>
        </div>
    </div>
    <!-- END MIDDLE COLUMN CONTENT -->
        <div class="hide">
            Updated 
            <script>
                document.write(document.lastModified);
            </script>
        </div>
    <div id="app-build"></div>
</body>
</html>
