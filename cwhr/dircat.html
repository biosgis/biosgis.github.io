<!DOCTYPE html>
<html>
<head>
    <title>Query Catalog</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        html,
        body {
            font-family: Consolas, Monaco, Courier New, Courier, monospace;
            font-size: 100%;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: ghostwhite;
            border-bottom: 1px solid silver;
        }
        h1 {
            font-family: 'Arial Black', Tahoma, Impact, fantasy;
            margin: 8px;
        }
        h2 {
            margin: 5px;
        }
        nav {
            background-color: aliceblue;
            border-bottom: 1px solid silver;
        }
        aside {
            position: fixed; bottom: 30px; right: 30px;
            height: auto; width: auto;
            background-color: azure;
            border: 1px solid silver;
            float: right;
        }
        main {
            position: relative;
            height: 80%;
            padding: 1%;
            width: auto;
        }
        footer {
            background-color: whitesmoke;
            border-top: 1px solid silver;
            margin-top: 5px;
            padding: 2px;
        }
        #cat {
            background-color: white;
            border: 1px solid silver;
            margin: 5px 0;
            padding: 5px;
            position: relative;
        }
        #map3d {
            background-color: azure;
            border: 1px solid silver;
            height: 500px;/*20171005 If position not absolute height must be in pixels.*/
            margin: 5px 0;
            padding: 0;
            position: relative;
            width: 100%;
        }
        #optionsDiv {
            background-color: dimgray;
            color: white;
            padding: 0px 0px 0px 10px;
            border-bottom-left-radius: 5px;
            max-width: 350px;
        }
        #msgbin {
            background-color: lightgray;
            margin: 5px 0;
            overflow: hidden;
            position: relative;
            z-index: 500;
        }
        #msgbox {
            background-color: black;
            border: 2px solid silver;
            color: white;
            font: normal normal normal 100% monospace, Consolas, Monaco, Courier, Terminal;
            height: 600px;
            overflow: auto;
            padding: 2px;
        }
        #msgbut {
            background-color: silver;
            font-weight: bold;
            position: absolute;
            top: 0; right: 0;
            z-index: 400;
        }
        .esri-popup .esri-popup-header .esri-title {
            font-size: 18px;
            font-weight: bolder;
        }
        .esri-popup .esri-popup-body .esri-popup-content {
            font-size: 14px;
        }
        .alink {
            border: 1px solid transparent;
            border-radius: 3px;
            margin: 0 2px;
            padding: 2px;
            text-decoration: none;
        }
        .alink:hover {
            background-color: snow;
            border: 1px solid antiquewhite;
        }
        .Feature {
            border-left: 5px solid magenta;
        }
        .FeatureServer {
            border-left: 5px solid orange;
        }
        .GPServer {
            border-left: 5px solid slategray;
        }
        .Group {
            border-left: 5px solid limegreen;
        }
        .Layer {
            border-left: 5px solid cyan;
        }
        .MapServer {
            border-left: 5px solid steelblue;
        }
        .Raster {
            border-left: 5px solid khaki;
        }
        .navlink:hover {
            background-color: antiquewhite;
            cursor: default;
        }
    </style>
    <link rel="stylesheet" href="https://js.arcgis.com/4.7/esri/css/main.css">
    <script src="https://js.arcgis.com/4.7/"></script>
    <script>
        function $(id) { return document.getElementById(id); }
        function hide(id) { $(id).style.display = 'none'; }
        function show(id) { $(id).style.display = ''; }
        function toggle(id) { $(id).style.display = ($(id).style.display === 'none' ? '' : 'none'); }
        function add(a, b) { return a + b; }
        function addmsg(s) { $('msgbox').innerHTML += s + '<br />'; }
        function arrayPunch(arr, s) {
            var out = [];
            var k = -1;
            for (var i = 0; i < arr.length; i++) {
                if (arr[i] === s) {
                    k = i;
                } else {
                    out.push(arr[i])
                }
            }
            return [out, k];
        }
        var app = {
            "avn": 20171114
        };
        var bee;//bb//busybee
        var cat = {
            "url": "https://map.dfg.ca.gov/arcgis/rest/services",
            "hostname": "map.dfg.ca.gov",
            "btoken": "Bn9ynBcrJejbEj3AhSS8Ajw6h16lH2cEkunDfaxXPFKKB_EK5-TIyzMVppjH26W3SizMs_E3uiA8DMLFjp5mFg..",
            "folders": [],
            "services": [],
            "servicecount": 0,
            "groupcount": 0,
            "layercount": 0,
            "rastercount": 0
        };
        var dirs = [];
        var servers = [];
        var spaths = [];
        var refs = [
            { "QueryTask Sample": "https://developers.arcgis.com/javascript/latest/sample-code/tasks-query/index.html" },
            { "request Refdoc": "https://developers.arcgis.com/javascript/latest/api-reference/esri-request.html" }
        ];
        if (location.hostname.indexOf('map.dfg.ca.gov') === 0) {
            cat.url = 'https://map.dfg.ca.gov/arcgis/rest/services'
            cat.btoken = "Bn9ynBcrJejbEj3AhSS8Ajw6h16lH2cEkunDfaxXPFKKB_EK5-TIyzMVppjH26W3SizMs_E3uiA8DMLFjp5mFg..";
            cat.hostname = location.host;
        } else if (location.hostname.indexOf('.dfg.ca.gov') > 0) {
            cat.url = location.origin + '/arcgis/rest/services';
            cat.btoken = "zHapNnrWOtORQu7obhZEMRyAOxAgHTkMU5qMukNycj4u1edyxDKkG3RxDBmwQ-MZqY8cIWHe3CFT1GypqDFIsQ..";
            cat.hostname = location.host;
        } else {
            cat.url = 'https://map.dfg.ca.gov/arcgis/rest/services';
            cat.btoken = '';
            cat.hostname = 'map.dfg.ca.gov';
        }
        function beeGo() {
            if (typeof (Worker) !== 'undefined') {
                if (typeof (bee) === 'undefined') {
                    bee = new Worker('workbee.js');
                }
                var indata = {
                    "args": cat,
                    "op": "getfolders"
                }
                bee.postMessage(indata);
                bee.onmessage = function (event) {
                    addmsg(event.data);
                }
            }
        }
        function beeStop() {
            bee.terminate();
            bee = undefined;
        }
        var w;
        function startWorker() {
            if (typeof (Worker) !== "undefined") {
                if (typeof (w) == "undefined") {
                    w = new Worker("demo_workers.js");
                }
                w.onmessage = function (event) {
                    document.getElementById("dtime").innerHTML = event.data;
                };
            } else {
                document.getElementById("dtime").innerHTML = "Your browser does not support Web Workers";
            }
        }
        function stopWorker() {
            w.terminate();
            w = undefined;
        }
    </script>

    <script>
        var esrequest = null;
        var EsriQueryTask, EsriQuery;
        require([
            "esri/Map",
            "esri/views/SceneView",
            "esri/layers/GraphicsLayer",
            "esri/tasks/QueryTask",
            "esri/tasks/support/Query",
            "esri/request",
            "dojo/_base/array",
            "dojo/dom",
            "dojo/on",
            "dojo/domReady!"
        ], function (
            Map, SceneView, GraphicsLayer,
            QueryTask, Query,
            esriRequest,
            arrayUtils, dom, on
        ) {
            esrequest = esriRequest; // GLOBALIZE
            EsriQuery = Query;
            EsriQueryTask = QueryTask;
            // URL to feature service containing points representing the 50
            // most prominent peaks in the U.S.
            var peaksUrl =
                    "https://services.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/Prominent_Peaks_US/FeatureServer/0";

            // Define the popup content for each result
            var popupTemplate = {// autocasts as new PopupTemplate()
                title: "{MTN_PEAK}, {STATE}",
                fieldInfos: [{
                    fieldName: "ELEV_ft",
                    label: "Elevation (feet)",
                    format: {
                        places: 0,
                        digitSeperator: true
                    }
                }, {
                    fieldName: "ELEV_m",
                    label: "Elevation (meters)",
                    format: {
                        places: 0,
                        digitSeperator: true
                    }
                }, {
                    fieldName: "PROMINENCE_ft",
                    label: "Prominence (feet)",
                    format: {
                        places: 0,
                        digitSeperator: true
                    }
                }, {
                    fieldName: "PROMINENCE_m",
                    label: "Prominence (meters)",
                    format: {
                        places: 0,
                        digitSeperator: true
                    }
                }, {
                    fieldName: "ISOLATION_mi",
                    label: "Isolation (miles)",
                    format: {
                        places: 0,
                        digitSeperator: true
                    }
                }, {
                    fieldName: "ISOLATION_km",
                    label: "Isolation (km)",
                    format: {
                        places: 0,
                        digitSeperator: true
                    }
                }],
                content: "<b><a href='https://en.wikipedia.org/wiki/Topographic_prominence'>Prominence:</a>" +
                        "</b> {PROMINENCE_ft} ft ({PROMINENCE_m} m)" +
                        "<br><b>Prominence Rank:</b> {RANK}" +
                        "<br><b>Elevation:</b> {ELEV_ft} ft ({ELEV_m} m)" +
                        "<br><b><a href='https://en.wikipedia.org/wiki/Topographic_isolation'>Isolation:</a>" +
                        "</b> {ISOLATION_mi} mi ({ISOLATION_km} km)"
            };

            var mtnSymbol = {
                type: "point-3d", // autocasts as new PointSymbol3D()
                symbolLayers: [{
                    type: "object", // autocasts as new ObjectSymbol3DLayer()
                    resource: {
                        primitive: "cone"
                    }
                }]
            };

            // Create graphics layer and symbol to use for displaying the results of query
            var resultsLyr = new GraphicsLayer();

            /*****************************************************************
             *  Point QueryTask to URL of feature service
             *****************************************************************/
            var qTask = new QueryTask({
                url: peaksUrl
            });

            /******************************************************************
             * Set the query parameters to always return geometry and all fields.
             * Returning geometry allows us to display results on the map/view
             ******************************************************************/
            var params = new Query({
                returnGeometry: true,
                outFields: ["*"]
            });

            var map = new Map({
                basemap: "osm",
                layers: [resultsLyr] // add graphics layer to the map
            });

            var view = new SceneView({
                map: map,
                container: "map3d",
                center: [-121.234, 38.567],
                zoom: 8,
                popup: {
                    dockEnabled: true,
                    dockOptions: {
                        position: "top-right",
                        breakpoint: false
                    }
                }
            });

            // Call doQuery() each time the button is clicked
            view.then(function () {
                view.ui.add("optionsDiv", "bottom-right");
                on(dom.byId("doBtn"), "click", doQuery);
            });

            var attributeName = dom.byId("attSelect");
            var expressionSign = dom.byId("signSelect");
            var value = dom.byId("valSelect");

            // Executes each time the button is clicked
            function doQuery() {
                // Clear the results from a previous query
                resultsLyr.removeAll();
                /*********************************************
                 *
                 * Set the where clause for the query. This can be any valid SQL expression.
                 * In this case the inputs from the three drop down menus are used to build
                 * the query. For example, if "Elevation", "is greater than", and "10,000 ft"
                 * are selected, then the following SQL where clause is built here:
                 *
                 * params.where = "ELEV_ft > 10000";
                 *
                 * ELEV_ft is the field name for Elevation and is assigned to the value of the
                 * select option in the HTML below. Other operators such as AND, OR, LIKE, etc
                 * may also be used here.
                 *
                 **********************************************/
                params.where = attributeName.value + expressionSign.value + value.value;

                // executes the query and calls getResults() once the promise is resolved
                // promiseRejected() is called if the promise is rejected
                qTask.execute(params)
                        .then(getResults)
                        .otherwise(promiseRejected);
            }

            // Called each time the promise is resolved
            function getResults(response) {

                // Loop through each of the results and assign a symbol and PopupTemplate
                // to each so they may be visualized on the map
                var peakResults = arrayUtils.map(response.features, function (
                        feature) {

                    // Sets the symbol of each resulting feature to a cone with a
                    // fixed color and width. The height is based on the mountain's elevation
                    feature.symbol = {
                        type: "point-3d", // autocasts as new PointSymbol3D()
                        symbolLayers: [{
                            type: "object", // autocasts as new ObjectSymbol3DLayer()
                            material: {
                                color: "green"
                            },
                            resource: {
                                primitive: "cone"
                            },
                            width: 100000,
                            height: feature.attributes.ELEV_m * 100
                        }]
                    };

                    feature.popupTemplate = popupTemplate;
                    return feature;
                });

                resultsLyr.addMany(peakResults);

                // animate to the results after they are added to the map
                view.goTo(peakResults).then(function () {
                    view.popup.open({
                        features: peakResults,
                        featureMenuOpen: true,
                        updateLocationEnabled: true
                    });
                });

                // print the number of results returned to the user
                dom.byId("printResults").innerHTML = peakResults.length +
                        " results found!";
            }

            // Called each time the promise is rejected
            function promiseRejected(err) {
                console.error("Promise rejected: ", err.message);
            }

            getIdcount = function (urid) {
                var url = $(urid + '-link').href;
                addmsg('DO getIdcount for ' + url);
                var queryTask = new EsriQueryTask({
                    url: url
                });
                var query = new EsriQuery();
                query.returnGeometry = false;
                query.outFields = ["*"];
                query.where = "OBJECTID > 0";
                //20171010 Returns a count of the features that satisfy the query.
                queryTask.executeForCount(query).then(function (results) {
                    addmsg('CALLBACK getIdcount for ' + urid + ' with feature count=' + results);
                    $(urid + '-fcnt').innerHTML = ' features: ' + results;
                }, function (err) {
                    $(urid + '-fcnt').innerHTML = err.message;
                });
                // TODO Other methods
                //queryTask.executeForExtent()(query).then(function (results) {
                //    console.log(results.count);
                //    console.log(results.extent.xmax);
                //});
                //queryTask.executeForIds(query).then(function (results) {
                //    console.log(results.length);//count of oids
                //});
                //querytask.execute(query).then(function (results) {
                //    console.log(results.features.length);
                //});
            }
        });//DONE_AMD_REQUIRED
        //--- ARCGIS SERVER REST DIRECTORY WALK ----------------------20171005
        function errmsg(err) {
            addmsg(err.message);
        }
        function listfolders() {
            addmsg('DO listfolders t=' + Date.now());
            var root = $('dir-list');
            var url = cat.url + '?f=json';// '?f=json&token=' + cat.btoken;//=FAIL if btoken blank
            if (cat.btoken !== '') {
                url = url + '&token=' + cat.btoken;
            }
            esrequest(url, {
                responseType: "json"
            }).then(function (response) {
                var json = response.data;
                var folders = json.folders;
                dirs = folders;
                cat.folders = folders;
                cat.foldercount = folders.length;
                var type = 'folder';
                for (var i = 0; i < folders.length; i++) {
                    //addmsg('i,len=' + [i, folders.length]); //addmsg(folders[i]);
                    var urid = folders[i];
                    var item = document.createElement('li');
                    item.id = urid + '-item';
                    item.innerHTML = folders[i] + ' (Folder)';
                    item.setAttribute('data-type', type);
                    var tug = document.createElement('span');
                    tug.id = urid + '-tug';
                    tug.className = 'esri-icon-right';
                    tug.setAttribute('onclick', "toggle('" + urid + "-list')");
                    //tug.onclick = function () { toggle(parentNode.id.split('-')[0] + '-list'); }//FAIL
                    tug.style.cursor = 'default';
                    item.appendChild(tug);
                    var list = document.createElement('ol');
                    list.id = urid + '-list';
                    list.style.display = 'none';
                    item.appendChild(list);
                    root.appendChild(item);
                    listservices(folders[i]);
                }
            });
        }
        function listservices(dir) {
            addmsg('DO listservices for ' + dir);
            var root = $(dir + '-list');
            var url = cat.url + '/' + dir + '?f=json';
            if (cat.btoken !== '') {
                url = url + '&token=' + cat.btoken;
            }
            esrequest(url, {
                responseType: "json"
            }).then(function (response) {
                var json = response.data;
                var services = json.services;
                servers = servers.concat(services);
                cat.services = cat.services.concat(services);
                for (var i = 0; i < services.length; i++) {
                    //addmsg(services[i].name + '/' + services[i].type);
                    var serverpath = services[i].name + '/' + services[i].type;
                    spaths.push(serverpath);
                    var name = services[i].name.split('/')[1];
                    var type = services[i].type;
                    var urid = name;
                    if (type === 'FeatureServer') {
                        urid = name + '_f'; //20171009 for avoiding FeatureServer and MapServer conflict
                    }
                    var item = document.createElement('li');
                    item.id = urid + '-item';
                    item.innerHTML = name + ' (' + type + ')';
                    item.setAttribute('data-type', type);
                    //item.title = type;
                    item.className = type;
                    var tug = document.createElement('span');
                    tug.id = urid + '-tug';
                    tug.className = 'esri-icon-right';
                    tug.setAttribute('onclick', "toggle('" + urid + "-list');listlayers('" + serverpath + "')");
                    //tug.onclick = function () { toggle(parentNode.id.split('-')[0] + '-list'); }
                    tug.style.cursor = 'default';
                    item.appendChild(tug);
                    var list = document.createElement('ol');
                    list.id = urid + '-list';
                    list.style.display = 'none';
                    item.appendChild(list);
                    root.appendChild(item);
                    cat.servicecount += 1;
                    //KO if simply call listlayers at end of services loop
                    if (i === (services.length - 1)) {
                        $(dir + '-tug').style.border = '1px solid dimgray';
                    }
                }
                var ak = arrayPunch(dirs, dir);
                dirs = ak[0];
                //addmsg('DONE listing services for ' + dir + ' t=' + Date.now());
                $('servicecount').innerHTML = cat.servicecount;
                //addmsg('servers-count: ' + servers.length);
                //addmsg('spaths-count: ' + spaths.length);
                if (dirs.length === 0) {
                    addmsg('All services under all folders listed');
                    //listlayers();//NEXT
                    //setTimeout(function(){
                    //    listlayers();
                    //}, 1000);
                    //loopservers();
                    //looper = setInterval(function () { looperfun(); }, 1000);
                    w.postMessage(1230);
                    var indata = {
                        "args": spaths,
                        "op": "loopservers"
                    }
                    bee.postMessage(indata);//20171010
                    bee.onmessage = function (event) {
                        //addmsg(event.data);
                        beeswag(event.data);
                    }
                }
            });
        }
        function loopservers() {
            var i = 0;
            while (spaths.length > 0) {
                var serverpath = spaths.shift();
                i += 1;
                addmsg('serverpath-' + i + '=' + serverpath);
            }
        }
        function looperfun() {
            if (spaths.length > 0) {
                var serverpath = spaths.shift();
                i = servers.length - spaths.length;
                addmsg('serverpath-' + i + '=' + serverpath);
                //listlayers(serverpath);//20171009 THIS WILL GET ALMOST ALL LAYERS
            } else {
                addmsg('CLEAR looper');
                window.clearInterval(looper);
                stopWorker();
            }
        }
        function listlayers(serverpath) {
            //if (spaths.length === 0) {
            //    return;
            //}
            if (serverpath === undefined) {
                if (spaths.length > 0) {
                    var serverpath = spaths.shift();
                }
            }
            var name = serverpath.split('/')[1];
            var stype = serverpath.split('/')[2];
            if ((stype === 'MapServer' || stype === 'FeatureServer') === false) {
                return;
            }
            addmsg('DO listlayers for ' + serverpath + ' t=' + Date.now());
            var sid = name;
            if (stype === 'FeatureServer') {
                sid = name + '_f';
            }
            if ($(sid + ':0-item') !== null) {
                return;
            }
            var root = $(sid + '-list');
            var url = cat.url + '/' + serverpath + '?f=json';
            if (cat.btoken !== '') {
                url = url + '&token=' + cat.btoken;
            }
            esrequest(url, {
                responseType: "json"
            }).then(function (response) {
                addmsg('CALLBACK listlayers for ' + serverpath + ' t=' + Date.now());
                var json = response.data;
                var layers = json.layers;
                for (var i = 0; i < layers.length; i++) {
                    addmsg(layers[i].id + '/' + layers[i].name);
                    var info = layers[i];
                    var lid = info.id;
                    var name = info.name;
                    var urid = sid + ':' + lid;
                    var url = cat.url + '/' + serverpath + '/' + lid;
                    var subs = info.subLayerIds;
                    if (subs === null) {
                        var type = 'Layer';
                        if (stype === 'FeatureServer') {
                            type = 'Feature';
                        }
                        cat.layercount += 1;
                    } else if (subs.length > 0) {
                        var type = 'Group';// 'Layer';//
                        cat.groupcount += 1;
                    }
                    var item = document.createElement('li');
                    item.id = urid + '-item';
                    item.innerHTML = name + ' (' + type + ')';
                    item.setAttribute('data-type', type);
                    //item.title = type;
                    item.className = type;
                    //addmsg('Created item ' + item.id);
                    var linker = document.createElement('a');
                    linker.id = urid + '-link';
                    linker.href = url;
                    linker.className = 'esri-icon-link alink';
                    linker.target = '_blank';
                    item.appendChild(linker);
                    //addmsg('Created linker ' + linker.id);
                    var tug = document.createElement('span');
                    tug.id = urid + '-tug';
                    tug.className = 'esri-icon-right-arrow';
                    tug.setAttribute('onclick', "getIdcount('" + urid + "')");
                    //tug.onclick = function () { toggle(parentNode.id.split('-')[0] + '-list'); }
                    tug.style.cursor = 'default';
                    item.appendChild(tug);
                    //addmsg('Created tug ' + tug.id);
                    var fcnt = document.createElement('span');
                    fcnt.id = urid + '-fcnt';
                    item.appendChild(fcnt);
                    //addmsg('Created quot ' + fcnt.id);
                    //var list = document.createElement('ol');
                    //list.id = urid + '-list';
                    //list.style.display = 'none';
                    //item.appendChild(list);
                    root.appendChild(item);
                    //addmsg('Appended item to root ' + root.id);
                    if (i === (layers.length - 1)) {
                        //listlayers(); // iterate self while serversLength gt zero
                        //setTimeout(function(){//20171009 SETTIMEOUT should be done only once on a fxn not repeatedly
                        //    listlayers();
                        //}, 1000);
                        var ak = arrayPunch(spaths, serverpath);// IF NOT SHIFTED OUT ALREADY then remove fromarr
                        spaths = ak[0];
                        $(sid + '-tug').style.border = '1px solid green';
                    }
                }
                addmsg('DONE listlayers for ' + serverpath + ' t=' + Date.now());
                //$(sid + '-item').innerHTML = sid;
                $(sid + '-item').className = stype;
                $('groupcount').innerHTML = cat.groupcount;
                $('layercount').innerHTML = cat.layercount;
            });
        }
        function beeswag(data) {
            var arr = data.split('|');
            var drone = arr[0];
            var op = arr[1];
            var sid = arr[2];
            var html = arr[3];
            var k = arr[4];
            var t = parseInt(arr[5]);
            if (sid === 'done') {
                cat.groupcount = arr[3];
                cat.layercount = arr[4];
                $('groupcount').innerHTML = cat.groupcount;
                $('layercount').innerHTML = cat.layercount;
            } else if (op === 'getservicelayers' && $(sid + '-list') !== null && $(sid + ':0-item') === null) {
                $(sid + '-list').innerHTML += html;
                $(sid + '-tug').style.border = '1px solid green';
                addmsg('DONE beeswag: ' + sid + ', services to go=' + k + ',  t=' + t);
                $('dtime').innerHTML = (new Date(t)).toLocaleString();
            } else if (op === 'getTopLayerRowCount' && $(sid + '-fcnt') !== null) {
                addmsg('DO beeswag: ' + data);
                if (html === 'OK') {
                    $(sid + '-fcnt').innerHTML = k;
                    $(sid + '-tug').style.border = '2px solid royalblue';
                } else {
                    $(sid + '-fcnt').innerHTML = html;
                }
                $('dtime').innerHTML = (new Date(t)).toLocaleString();
            } else if (op === 'getreccount' && $(sid + '-fcnt') !== null) {
                if (html === 'OK') {
                    $(sid + '-fcnt').innerHTML = k;
                } else {
                    $(sid + '-fcnt').innerHTML = html;
                }
            }
        }
        function initp() {
            $('ags').href = cat.url;
            $('ags').innerHTML = cat.hostname + ' (Host)';
            $('msgbut').value = 'v' + app.avn;
            listfolders();
            startWorker();
            beeGo();
            if (location.search.indexOf('msg=yes') > 0) {
                show('msgbin');
            }
        }
        window.onload = initp;
    </script>
</head>
<body>
    <header>
        <h1>
            ArcGIS Server REST Services Directory Catalog
        </h1>
    </header>
    <nav>
        <a class="navlink" onclick="toggle('cat')">List</a>|
        <a class="navlink" onclick="toggle('map3d')">Map</a>|
        <a class="navlink" onclick="toggle('msgbin')">Messages</a>
        <span style="float: right;"><output id="dtime">-</output></span>
    </nav>
    <main>
        <div id="cat">
            <h2>
                <a href="https://map.dfg.ca.gov/arcgis/rest" id="ags" target="_blank">
                    ArcGIS Server
                </a>
            </h2>
            <div>
                Services: <span id="servicecount">0</span>,&nbsp;
                Group Layers: <span id="groupcount">0</span>,&nbsp;
                Feature Layers: <span id="layercount">0</span>,&nbsp;
                Raster Layers: <span id="rastercount">0</span>,&nbsp;
                GPTools: <span id="gptoolcount">0</span>
            </div>
            <ol id="dir-list">

            </ol>
        </div>
        <input type="button" id="msgbut" value="&rect;" onclick="toggle('msgbin')" />
        <div id="msgbin" style="display: none;">
            <h2>
                Messages starting 
                <script>
                    document.write((new Date()).toString());//.toISOString());//.toLocaleString());//.toUTCString());// Date.now());//
                </script>
                <span class="esri-icon-close" aria-label="close icon" style="float: right;" onclick="hide('msgbin')"></span>
            </h2>
            <div id="msgbox"></div>
        </div>
        <div id="map3d"></div>
        <aside>
            <div id="optionsDiv">
                <h2>Prominent Peaks in the U.S.</h2>
                <select id="attSelect">
                    <option value="ELEV_ft">Elevation</option>
                    <option value="PROMINENCE_ft" selected>Prominence</option>
                </select>
                <select id="signSelect">
                    <option value=">">is greater than</option>
                    <option value="<">is less than</option>
                    <option value="=">is equal to</option>
                </select>
                <select id="valSelect">
                    <option value="1000">1,000 ft</option>
                    <option value="5000">5,000 ft</option>
                    <option value="10000">10,000 ft</option>
                    <option value="15000">15,000 ft</option>
                    <option value="20000">20,000 ft</option>
                </select>
                <br>
                <br>
                <button id="doBtn">Do Query</button>
                <br>
                <p><span id="printResults"></span></p>
            </div>
        </aside>
    </main>
    <footer>
        <table style="background-color: transparent; border: none; width: 100%;">
            <tr>
                <td class="tdleft" title="navigator.userAgent platform(OS)">
                    <script>
                            document.write(navigator.userAgent + "-" + navigator.platform);
                    </script>
                </td>
                <td class="tdleft" onclick="toggle('windowprops')">
                    &boxbox;
                </td>
                <td class="tdright" title="author, contact">
                    <a href="mail:dean.chiang@wildlife.ca.gov">dchiang@dfg</a>
                    &copy;
                    <script>
                                document.write(document.lastModified);
                    </script>
                </td>
            </tr>
            <tr id="windowprops" style="display: none;">
                <td class="tdleft">
                    <script>
                            var br = "<br />";
                            var msg = "window.innerHeight=" + window.innerHeight + br +
                                "window.innerWidth=" + window.innerWidth + br +
                                "window.scrollX=" + window.scrollX + br + // Horizontal scrolling
                                "window.scrollY=" + window.scrollY + br + // Vertical scrolling
                                "window.screen.availHeight=" + window.screen.availHeight + br +
                                "window.screen.availLeft=" + window.screen.availLeft + br +
                                "window.screen.availTop=" + window.screen.availTop + br +
                                "window.screen.availWidth=" + window.screen.availWidth + br +
                                "window.screen.colorDepth=" + window.screen.colorDepth + br +
                                "window.screen.height=" + window.screen.height + br +
                                "window.screen.pixelDepth=" + window.screen.pixelDepth + br +
                                "window.screen.width=" + window.screen.width + br +
                                "navigator.appName=" + navigator.appName + "<br />" +
                                "navigator.appCodeName=" + navigator.appCodeName + "<br />" +
                                "navigator.appVersion=" + navigator.appVersion + "<br />" +
                                "navigator.product=" + navigator.product + "<br />" +
                                "navigator.cookieEnabled=" + navigator.cookieEnabled;
                                //"navigator.platform(operating system)=" + navigator.platform + "<br />" +
                                //"navigator.userAgent=" + navigator.userAgent + "<br />";
                            //document.getElementById("window_info").innerHTML = msg;
                            document.write(msg);
                    </script>
                </td>
                <td class="tdleft"></td>
                <td class="tdright"></td>
            </tr>
        </table>
    </footer>
</body>
</html>
<!--// NOTES //
20171007-BUG: SERVICE with both FeatureServer and MapServer need more unique names than urid=sid:lid
-->